/*!
 * remark (http://getbootstrapadmin.com/remark)
 * Copyright 2015 amazingsurge
 * Licensed under the Themeforest Standard Licenses
 */
!function(document,window,$){"use strict";window.AppLocation=App.extend({handleMap:function(){function addMarker(allFriendId,allFriends){for(var i=0;i<allFriends.length;i++){var x,path;x=i%2===0?1*Math.random():-1*Math.random();var markerLatlng=L.latLng(37.769+Math.random()/170*x,-122.446+Math.random()/150*x);path=allFriends[i].find("img").attr("src");var divContent="<div class='in-map-markers'><div class='friend-icon'><img src='"+path+"' alt='"+allFriendId[i]+"' /></div></div>",friendImg=L.divIcon({html:divContent,iconAnchor:[0,0],className:""}),popupInfo="<div class='friend-popup-info'><div class='detail'>info</div><h3>"+allFriends[i].find(".friend-name").html()+"</h3><p>"+allFriends[i].find(".friend-title").html()+"</p></div><i class='icon wb-chevron-right-mini'></i>",marker=L.marker(markerLatlng,{alt:allFriendId[i],title:$allFriends[i].getElementsByClassName("friend-name")[0].innerHTML,icon:friendImg}).bindPopup(popupInfo,{closeButton:!1});markers.addLayer(marker),self.allMarkers.push(marker),marker.on("popupopen",function(){this._icon.className+=" marker-active",this.setZIndexOffset(999)}),marker.on("popupclose",function(){this._icon&&(this._icon.className="leaflet-marker-icon leaflet-zoom-animated leaflet-clickable"),this.setZIndexOffset(450)})}map.addLayer(markers)}function getInMapMarkers(){for(var inMapMarkersId=[],listFriends=[],i=0;i<self.allMarkers.length;i++)map.getBounds().contains(self.allMarkers[i].getLatLng())&&inMapMarkersId.push(self.allMarkers[i].options.alt);for(var i=0;i<self.allFriends.length;i++)-1===inMapMarkersId.indexOf(self.allFriends[i].attr("data-friend-id"))?self.allFriends[i].hide():self.allFriends[i].show();for(var i=0;i<inMapMarkersId.length;i++)$(".app-location .friend-info").each(function(){$(this).attr("data-friend-id")===inMapMarkersId[i]&&listFriends.push($(this))});self.inListFriends=listFriends}var self=this,navbarH=$(".site-navbar").outerHeight(),footerH=$(".site-footer").outerHeight(),mapH=$(window).height()-navbarH-footerH;$(".page-main").outerHeight(mapH);var mapLatlng=L.latLng(37.769,-122.446),$allFriends=$(".app-location .friend-info");$allFriends.each(function(){self.allFriends.push($(this))}),L.mapbox.accessToken="pk.eyJ1IjoiYW1hemluZ3N1cmdlIiwiYSI6ImNpaDVubzBoOTAxZG11dGx4OW5hODl2b3YifQ.qudwERFDdMJhFA-B2uO6Rg";var map=L.mapbox.map("map","mapbox.light").setView(mapLatlng,18);$allFriends.each(function(){self.allFriendId.push($(this).attr("data-friend-id"))});var markers=new L.MarkerClusterGroup({removeOutsideVisibleBounds:!1,polygonOptions:{color:"#444"}});addMarker(self.allFriendId,self.allFriends),map.once("ready",getInMapMarkers),map.on("viewreset",getInMapMarkers),map.on("moveend",getInMapMarkers),this.handleClickAction(map)},handleFind:function(){var self=this;$(".search-friends input").on("focus",function(){$(this).on("keyup",function(){for(var inputName=$(".search-friends input").val(),i=0;i<self.inListFriends.length;i++){var friendName=self.inListFriends[i].find(".friend-name").html();if(inputName.length<=friendName.length)for(var j=1;j<=inputName.length;j++)inputName.substring(0,j).toLowerCase()===friendName.substring(0,j).toLowerCase()?self.inListFriends[i].show():self.inListFriends[i].hide();else self.inListFriends[i].hide()}if(""===inputName)for(var i=0;i<self.inListFriends.length;i++)self.inListFriends[i].show()})}),$(".search-friends input").on("focusout",function(){$(this).off("keyup")})},handleResize:function(){$(window).on("resize",function(){var navbarH=$(".site-navbar").outerHeight(),footerH=$(".site-footer").outerHeight(),mapH=$(window).height()-navbarH-footerH;$(".page-main").outerHeight(mapH)})},handleClickAction:function(map){var self=this;$(".app-location .page-aside .list-group").on("click",".widget-content",function(){var thisId=$(this).parents(".friend-info").attr("data-friend-id");$(".list-inline").on("click",function(event){event.stopPropagation()});for(var i=0;i<self.allMarkers.length;i++)self.allMarkers[i].options.alt===thisId&&(map.panTo(self.allMarkers[i].getLatLng()),self.allMarkers[i].openPopup())})},run:function(){this.allFriends=[],this.allFriendId=[],this.allMarkers=[],this.inListFriends=[],this.handleMap(),this.handleResize(),this.handleFind()}}),$(document).ready(function($){AppLocation.run()})}(document,window,jQuery);